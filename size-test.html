<html lang='en'>

<head>
  <meta charset='UTF-8' />
  <meta name='viewport' content='width=device-width, initial-scale=1' />
  <title>
    Staying In Bounds – Plutonomicon
  </title>
  
    
      <meta property='og:description' content />
      <meta property='og:site_name' content='Plutonomicon' />
      <meta property='og:type' content='website' />
      <meta property='og:title' content='Staying In Bounds' />
    
    
      <base href='/plutonomicon/' />
      <link href='logo.png' rel='icon' />
    
    <!-- Prism.js --><link href='https://cdnjs.cloudflare.com/ajax/libs/prism/1.26.0/themes/prism-tomorrow.min.css' rel='stylesheet' />
<script src='https://cdnjs.cloudflare.com/ajax/libs/prism/1.26.0/prism.min.js'></script>
<script src='https://cdnjs.cloudflare.com/ajax/libs/prism/1.26.0/plugins/autoloader/prism-autoloader.min.js'></script>

<script>
  window.MathJax = {
    startup: {
      ready: () => {
        MathJax.startup.defaultReady();
      }
    }
  };
</script>
<script async id='MathJax-script' src='https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js'></script>


  
  <link href='tailwind.css?instanceId=9a24feb3-1402-43d7-9ce7-e3d94a379675' rel='stylesheet' type='text/css' />

  <!-- Heist error element -->
  <style type='text/css'>
    strong.error {
      color: lightcoral;
      font-size: 90%;
      font-family: monospace;
    }
  </style>
  <!-- What goes in this file will appear on near the end of <head>--><link rel='preload' href='_emanote-static/fonts/Maven_Pro/MavenPro-VariableFont_wght.ttf' as='font' type='font/ttf' crossorigin />

<style>
  @font-face {
    font-family: 'MavenPro';
    /* FIXME: This ought to be: ${ema:emanoteStaticLayerUrl}/fonts/Maven_Pro/MavenPro-VariableFont_wght.ttf */
    src: url(_emanote-static/fonts/Maven_Pro/MavenPro-VariableFont_wght.ttf) format("truetype");
    font-display: swap;
  }

  body {
    font-family: 'MavenPro', sans-serif;
    /* font-variation-settings: 'wght'300; */
  }

  a.mavenLinkBold {
    font-variation-settings: 'wght'500;
  }

  strong {
    font-variation-settings: 'wght'500;
  }

  h1,
  h2,
  h3,
  h4,
  h5,
  h6,
  header,
  .header-font {
    font-family: 'MavenPro', sans-serif;
  }
</style>

  <head-main></head-main>
</head>

<!-- DoNotFormat -->



<!-- DoNotFormat -->

<body class='bg-gray-400 overflow-y-scroll'>
  
    <div class='container mx-auto'>

      <nav id='breadcrumbs' class='w-full text-gray-700 md:hidden'>
  <div class='flex justify-left'>
    <div class='w-full px-2 py-2 bg-gray-50'>
      <ul class='flex flex-wrap text-lg'>
        <li class='inline-flex items-center'>
          
            
              <img style='width: 1rem;' src='logo.png' />
            
          
        </li>
        
          
            <li class='inline-flex items-center'>
              <a class='px-1 font-bold' href=''>
                Plutonomicon
              </a>
              <svg fill='currentColor' viewBox='0 0 20 20' class='w-auto h-5 text-gray-400'>
                <path fill-rule='evenodd' d='M7.293 14.707a1 1 0 010-1.414L10.586 10 7.293 6.707a1 1 0 011.414-1.414l4 4a1 1 0 010 1.414l-4 4a1 1 0 01-1.414 0z' clip-rule='evenodd'></path>
              </svg>
            </li>
          
        
      </ul>
    </div>
    <button class='inline px-2 py-1 text-white bg-blue-600 outline-none cursor-pointer focus:outline-none' title='Toggle sidebar' type='button' onclick="toggleHidden('sidebar')">
      <svg xmlns='http://www.w3.org/2000/svg' class='w-4' fill='none' viewBox='0 0 24 24' stroke='currentColor'>
        <path stroke-linecap='round' stroke-linejoin='round' stroke-width='2' d='M4 6h16M4 12h16M4 18h16'></path>
      </svg>
    </button>
    <script>
      function toggleHidden(elemId) {
        document.getElementById(elemId).classList.toggle("hidden");
      }
    </script>
  </div>
</nav>

      <div id='container' class='flex flex-nowrap flex-col md:flex-row bg-gray-50 md:mt-8 md:shadow-2xl md:mb-8'>
        <!-- Sidebar column -->
        <nav id='sidebar' class='flex-shrink hidden leading-relaxed md:block md:sticky md:top-0 md:h-full md:w-48 xl:w-64'>
          <div class='px-2 py-2 text-gray-800'>

            <div id='indexing-links' class='flex flex-row float-right p-2 space-x-2 text-gray-500'>
              <a href='-/tags' title='View tags'>
                <svg style='width: 1rem;' class='hover:text-blue-700' fill='none' stroke='currentColor' viewBox='0 0 24 24' xmlns='http://www.w3.org/2000/svg'>
                  <path stroke-linecap='round' stroke-linejoin='round' stroke-width='2' d='M7 7h.01M7 3h5c.512 0 1.024.195 1.414.586l7 7a2 2 0 010 2.828l-7 7a2 2 0 01-2.828 0l-7-7A1.994 1.994 0 013 12V7a4 4 0 014-4z'>
                  </path>
                </svg>
              </a>
              <a href='-/all' title='Expand full tree'>
                <svg style='width: 1rem;' class='hover:text-blue-700' fill='none' stroke='currentColor' viewBox='0 0 24 24' xmlns='http://www.w3.org/2000/svg'>
                  <path stroke-linecap='round' stroke-linejoin='round' stroke-width='2' d='M4 8V4m0 0h4M4 4l5 5m11-1V4m0 0h-4m4 0l-5 5M4 16v4m0 0h4m-4 0l5-5m11 5l-5-5m5 5v-4m0 4h-4'>
                  </path>
                </svg>
              </a>
            </div>

            <div id='site-logo' class='pl-2'>
              <div class='flex items-center my-2 space-x-2 justify-left'>
                <a href='' title='Go to Home'>
                  
                    
                      <!-- The style width attribute here is to prevent huge
                      icon from displaying at those rare occasions when Tailwind
                      hasn't kicked in immediately on page load 
                      -->
                      <img style='width: 1rem;' class='transition transform hover:scale-110 hover:opacity-80' src='logo.png' />
                    
                  
                </a>
                <a class='font-bold truncate' title='Go to Home' href=''>
                  Home
                </a>
              </div>
            </div>

            
              <!-- Variable bindings for this tree-->
  
    
      
    
    



  


<!-- Rendering of this tree -->
<div class='pl-2'>
  <!-- Node's rootLabel-->
  <div class='flex items-center my-2 space-x-2 justify-left'>
    
    
      <svg class='w-4 h-4 flex-shrink-0 inline' fill='none' stroke='currentColor' viewBox='0 0 24 24' xmlns='http://www.w3.org/2000/svg'>
        <path stroke-linecap='round' stroke-linejoin='round' stroke-width='2' d='M7 21h10a2 2 0 002-2V9.414a1 1 0 00-.293-.707l-5.414-5.414A1 1 0 0012.586 3H7a2 2 0 00-2 2v14a2 2 0 002 2z'>
        </path>
      </svg>
    
  
    <a class='hover:underline truncate' title='CnG PToken' href='cngproof'>
      CnG PToken
    </a>
    
      
  </div>

  <!-- Node's children forest, displayed only on active trees
    TODO: Use <details> to toggle visibility?
  -->
  
    
  
</div>
            
              <!-- Variable bindings for this tree-->
  
    
      
    
    



  


<!-- Rendering of this tree -->
<div class='pl-2'>
  <!-- Node's rootLabel-->
  <div class='flex items-center my-2 space-x-2 justify-left'>
    
    
      <svg class='w-4 h-4 flex-shrink-0 inline' fill='none' stroke='currentColor' viewBox='0 0 24 24' xmlns='http://www.w3.org/2000/svg'>
        <path stroke-linecap='round' stroke-linejoin='round' stroke-width='2' d='M7 21h10a2 2 0 002-2V9.414a1 1 0 00-.293-.707l-5.414-5.414A1 1 0 0012.586 3H7a2 2 0 00-2 2v14a2 2 0 002 2z'>
        </path>
      </svg>
    
  
    <a class='hover:underline truncate' title='Common Plutus Vulnerabilities' href='vulnerabilities'>
      Common Plutus Vulnerabilities
    </a>
    
      
  </div>

  <!-- Node's children forest, displayed only on active trees
    TODO: Use <details> to toggle visibility?
  -->
  
    
  
</div>
            
              <!-- Variable bindings for this tree-->
  
    
      
    
    



  


<!-- Rendering of this tree -->
<div class='pl-2'>
  <!-- Node's rootLabel-->
  <div class='flex items-center my-2 space-x-2 justify-left'>
    
    
      <svg class='w-4 h-4 flex-shrink-0 inline' fill='none' stroke='currentColor' viewBox='0 0 24 24' xmlns='http://www.w3.org/2000/svg'>
        <path stroke-linecap='round' stroke-linejoin='round' stroke-width='2' d='M7 21h10a2 2 0 002-2V9.414a1 1 0 00-.293-.707l-5.414-5.414A1 1 0 0012.586 3H7a2 2 0 00-2 2v14a2 2 0 002 2z'>
        </path>
      </svg>
    
  
    <a class='hover:underline truncate' title='Consistency' href='consistency'>
      Consistency
    </a>
    
      
  </div>

  <!-- Node's children forest, displayed only on active trees
    TODO: Use <details> to toggle visibility?
  -->
  
    
  
</div>
            
              <!-- Variable bindings for this tree-->
  
    
      
    
    



  


<!-- Rendering of this tree -->
<div class='pl-2'>
  <!-- Node's rootLabel-->
  <div class='flex items-center my-2 space-x-2 justify-left'>
    
    
      <svg class='w-4 h-4 flex-shrink-0 inline' fill='none' stroke='currentColor' viewBox='0 0 24 24' xmlns='http://www.w3.org/2000/svg'>
        <path stroke-linecap='round' stroke-linejoin='round' stroke-width='2' d='M7 21h10a2 2 0 002-2V9.414a1 1 0 00-.293-.707l-5.414-5.414A1 1 0 0012.586 3H7a2 2 0 00-2 2v14a2 2 0 002 2z'>
        </path>
      </svg>
    
  
    <a class='hover:underline truncate' title='Distributed Map' href='DistributedMap'>
      Distributed Map
    </a>
    
      
  </div>

  <!-- Node's children forest, displayed only on active trees
    TODO: Use <details> to toggle visibility?
  -->
  
    
  
</div>
            
              <!-- Variable bindings for this tree-->
  
    
      
    
    



  


<!-- Rendering of this tree -->
<div class='pl-2'>
  <!-- Node's rootLabel-->
  <div class='flex items-center my-2 space-x-2 justify-left'>
    
    
      <svg class='w-4 h-4 flex-shrink-0 inline' fill='none' stroke='currentColor' viewBox='0 0 24 24' xmlns='http://www.w3.org/2000/svg'>
        <path stroke-linecap='round' stroke-linejoin='round' stroke-width='2' d='M7 21h10a2 2 0 002-2V9.414a1 1 0 00-.293-.707l-5.414-5.414A1 1 0 0012.586 3H7a2 2 0 00-2 2v14a2 2 0 002 2z'>
        </path>
      </svg>
    
  
    <a class='hover:underline truncate' title='FLLocked' href='forwarding2'>
      <em>FLLocked</em>
    </a>
    
      
  </div>

  <!-- Node's children forest, displayed only on active trees
    TODO: Use <details> to toggle visibility?
  -->
  
    
  
</div>
            
              <!-- Variable bindings for this tree-->
  
    
      
    
    



  


<!-- Rendering of this tree -->
<div class='pl-2'>
  <!-- Node's rootLabel-->
  <div class='flex items-center my-2 space-x-2 justify-left'>
    
    
      <svg class='w-4 h-4 flex-shrink-0 inline' fill='none' stroke='currentColor' viewBox='0 0 24 24' xmlns='http://www.w3.org/2000/svg'>
        <path stroke-linecap='round' stroke-linejoin='round' stroke-width='2' d='M7 21h10a2 2 0 002-2V9.414a1 1 0 00-.293-.707l-5.414-5.414A1 1 0 0012.586 3H7a2 2 0 00-2 2v14a2 2 0 002 2z'>
        </path>
      </svg>
    
  
    <a class='hover:underline truncate' title='Forwarding Minting Policy' href='forwarding1'>
      Forwarding Minting Policy
    </a>
    
      
  </div>

  <!-- Node's children forest, displayed only on active trees
    TODO: Use <details> to toggle visibility?
  -->
  
    
  
</div>
            
              <!-- Variable bindings for this tree-->
  
    
      
    
    



  


<!-- Rendering of this tree -->
<div class='pl-2'>
  <!-- Node's rootLabel-->
  <div class='flex items-center my-2 space-x-2 justify-left'>
    
    
      <svg class='w-4 h-4 flex-shrink-0 inline' fill='none' stroke='currentColor' viewBox='0 0 24 24' xmlns='http://www.w3.org/2000/svg'>
        <path stroke-linecap='round' stroke-linejoin='round' stroke-width='2' d='M7 21h10a2 2 0 002-2V9.414a1 1 0 00-.293-.707l-5.414-5.414A1 1 0 0012.586 3H7a2 2 0 00-2 2v14a2 2 0 002 2z'>
        </path>
      </svg>
    
  
    <a class='hover:underline truncate' title='Fundamentals of Plutus' href='fundamentals'>
      Fundamentals of Plutus
    </a>
    
      
  </div>

  <!-- Node's children forest, displayed only on active trees
    TODO: Use <details> to toggle visibility?
  -->
  
    
  
</div>
            
              <!-- Variable bindings for this tree-->
  
    
      
    
    



  


<!-- Rendering of this tree -->
<div class='pl-2'>
  <!-- Node's rootLabel-->
  <div class='flex items-center my-2 space-x-2 justify-left'>
    
    
      <svg class='w-4 h-4 flex-shrink-0 inline' fill='none' stroke='currentColor' viewBox='0 0 24 24' xmlns='http://www.w3.org/2000/svg'>
        <path stroke-linecap='round' stroke-linejoin='round' stroke-width='2' d='M7 21h10a2 2 0 002-2V9.414a1 1 0 00-.293-.707l-5.414-5.414A1 1 0 0012.586 3H7a2 2 0 00-2 2v14a2 2 0 002 2z'>
        </path>
      </svg>
    
  
    <a class='hover:underline truncate' title='How Stake Validators Actually Work' href='stake-scripts'>
      How Stake Validators Actually Work
    </a>
    
      
  </div>

  <!-- Node's children forest, displayed only on active trees
    TODO: Use <details> to toggle visibility?
  -->
  
    
  
</div>
            
              <!-- Variable bindings for this tree-->
  
    
      
    
    



  


<!-- Rendering of this tree -->
<div class='pl-2'>
  <!-- Node's rootLabel-->
  <div class='flex items-center my-2 space-x-2 justify-left'>
    
    
      <svg class='w-4 h-4 flex-shrink-0 inline' fill='none' stroke='currentColor' viewBox='0 0 24 24' xmlns='http://www.w3.org/2000/svg'>
        <path stroke-linecap='round' stroke-linejoin='round' stroke-width='2' d='M7 21h10a2 2 0 002-2V9.414a1 1 0 00-.293-.707l-5.414-5.414A1 1 0 0012.586 3H7a2 2 0 00-2 2v14a2 2 0 002 2z'>
        </path>
      </svg>
    
  
    <a class='hover:underline truncate' title='On-Chain Association List With Constant Time Insert-Removal' href='assoc'>
      On-Chain Association List With Constant Time Insert-Removal
    </a>
    
      
  </div>

  <!-- Node's children forest, displayed only on active trees
    TODO: Use <details> to toggle visibility?
  -->
  
    
  
</div>
            
              <!-- Variable bindings for this tree-->
  
    
      
    
    



  


<!-- Rendering of this tree -->
<div class='pl-2'>
  <!-- Node's rootLabel-->
  <div class='flex items-center my-2 space-x-2 justify-left'>
    
    
      <svg class='w-4 h-4 flex-shrink-0 inline' fill='none' stroke='currentColor' viewBox='0 0 24 24' xmlns='http://www.w3.org/2000/svg'>
        <path stroke-linecap='round' stroke-linejoin='round' stroke-width='2' d='M7 21h10a2 2 0 002-2V9.414a1 1 0 00-.293-.707l-5.414-5.414A1 1 0 0012.586 3H7a2 2 0 00-2 2v14a2 2 0 002 2z'>
        </path>
      </svg>
    
  
    <a class='hover:underline truncate' title='Optimizations to reduce CPU and Mem consumption' href='scriptmem'>
      Optimizations to reduce CPU and Mem consumption
    </a>
    
      
  </div>

  <!-- Node's children forest, displayed only on active trees
    TODO: Use <details> to toggle visibility?
  -->
  
    
  
</div>
            
              <!-- Variable bindings for this tree-->
  
    
      
    
    



  


<!-- Rendering of this tree -->
<div class='pl-2'>
  <!-- Node's rootLabel-->
  <div class='flex items-center my-2 space-x-2 justify-left'>
    
    
      <svg class='w-4 h-4 flex-shrink-0 inline' fill='none' stroke='currentColor' viewBox='0 0 24 24' xmlns='http://www.w3.org/2000/svg'>
        <path stroke-linecap='round' stroke-linejoin='round' stroke-width='2' d='M7 21h10a2 2 0 002-2V9.414a1 1 0 00-.293-.707l-5.414-5.414A1 1 0 0012.586 3H7a2 2 0 00-2 2v14a2 2 0 002 2z'>
        </path>
      </svg>
    
  
    <a class='hover:underline truncate' title='Plutus Core Builtin Functions Reference' href='builtin-functions'>
      Plutus Core Builtin Functions Reference
    </a>
    
      
  </div>

  <!-- Node's children forest, displayed only on active trees
    TODO: Use <details> to toggle visibility?
  -->
  
    
  
</div>
            
              <!-- Variable bindings for this tree-->
  
    
      
    
    



  


<!-- Rendering of this tree -->
<div class='pl-2'>
  <!-- Node's rootLabel-->
  <div class='flex items-center my-2 space-x-2 justify-left'>
    
    
      <svg class='w-4 h-4 flex-shrink-0 inline' fill='none' stroke='currentColor' viewBox='0 0 24 24' xmlns='http://www.w3.org/2000/svg'>
        <path stroke-linecap='round' stroke-linejoin='round' stroke-width='2' d='M7 21h10a2 2 0 002-2V9.414a1 1 0 00-.293-.707l-5.414-5.414A1 1 0 0012.586 3H7a2 2 0 00-2 2v14a2 2 0 002 2z'>
        </path>
      </svg>
    
  
    <a class='hover:underline truncate' title='Plutus Numeric Hierarchy' href='numeric'>
      Plutus Numeric Hierarchy
    </a>
    
      
  </div>

  <!-- Node's children forest, displayed only on active trees
    TODO: Use <details> to toggle visibility?
  -->
  
    
  
</div>
            
              <!-- Variable bindings for this tree-->
  
    
      
    
    



  


<!-- Rendering of this tree -->
<div class='pl-2'>
  <!-- Node's rootLabel-->
  <div class='flex items-center my-2 space-x-2 justify-left'>
    
    
      <svg class='w-4 h-4 flex-shrink-0 inline' fill='none' stroke='currentColor' viewBox='0 0 24 24' xmlns='http://www.w3.org/2000/svg'>
        <path stroke-linecap='round' stroke-linejoin='round' stroke-width='2' d='M7 21h10a2 2 0 002-2V9.414a1 1 0 00-.293-.707l-5.414-5.414A1 1 0 0012.586 3H7a2 2 0 00-2 2v14a2 2 0 002 2z'>
        </path>
      </svg>
    
  
    <a class='hover:underline truncate' title='README' href='README'>
      README
    </a>
    
      
  </div>

  <!-- Node's children forest, displayed only on active trees
    TODO: Use <details> to toggle visibility?
  -->
  
    
  
</div>
            
              <!-- Variable bindings for this tree-->
  
    
      
    
    



  


<!-- Rendering of this tree -->
<div class='pl-2'>
  <!-- Node's rootLabel-->
  <div class='flex items-center my-2 space-x-2 justify-left'>
    
    
      <svg class='w-4 h-4 flex-shrink-0 inline' fill='none' stroke='currentColor' viewBox='0 0 24 24' xmlns='http://www.w3.org/2000/svg'>
        <path stroke-linecap='round' stroke-linejoin='round' stroke-width='2' d='M7 21h10a2 2 0 002-2V9.414a1 1 0 00-.293-.707l-5.414-5.414A1 1 0 0012.586 3H7a2 2 0 00-2 2v14a2 2 0 002 2z'>
        </path>
      </svg>
    
  
    <a class='hover:underline truncate' title='Script optimisations' href='optimisations'>
      Script optimisations
    </a>
    
      
  </div>

  <!-- Node's children forest, displayed only on active trees
    TODO: Use <details> to toggle visibility?
  -->
  
    
  
</div>
            
              <!-- Variable bindings for this tree-->
  
    
      
    
    



  


<!-- Rendering of this tree -->
<div class='pl-2'>
  <!-- Node's rootLabel-->
  <div class='flex items-center my-2 space-x-2 justify-left'>
    
    
      <svg class='w-4 h-4 flex-shrink-0 inline' fill='none' stroke='currentColor' viewBox='0 0 24 24' xmlns='http://www.w3.org/2000/svg'>
        <path stroke-linecap='round' stroke-linejoin='round' stroke-width='2' d='M7 21h10a2 2 0 002-2V9.414a1 1 0 00-.293-.707l-5.414-5.414A1 1 0 0012.586 3H7a2 2 0 00-2 2v14a2 2 0 002 2z'>
        </path>
      </svg>
    
  
    <a class='hover:underline truncate' title='Sketch: Protocol Categories' href='protocol-category'>
      Sketch: Protocol Categories
    </a>
    
      
  </div>

  <!-- Node's children forest, displayed only on active trees
    TODO: Use <details> to toggle visibility?
  -->
  
    
  
</div>
            
              <!-- Variable bindings for this tree-->
  
    
      
    
    



  


<!-- Rendering of this tree -->
<div class='pl-2'>
  <!-- Node's rootLabel-->
  <div class='flex items-center my-2 space-x-2 justify-left'>
    
    
      <svg class='w-4 h-4 flex-shrink-0 inline' fill='none' stroke='currentColor' viewBox='0 0 24 24' xmlns='http://www.w3.org/2000/svg'>
        <path stroke-linecap='round' stroke-linejoin='round' stroke-width='2' d='M7 21h10a2 2 0 002-2V9.414a1 1 0 00-.293-.707l-5.414-5.414A1 1 0 0012.586 3H7a2 2 0 00-2 2v14a2 2 0 002 2z'>
        </path>
      </svg>
    
  
    <a class='hover:underline truncate' title='State Thread Token Pattern' href='statethread'>
      State Thread Token Pattern
    </a>
    
      
  </div>

  <!-- Node's children forest, displayed only on active trees
    TODO: Use <details> to toggle visibility?
  -->
  
    
  
</div>
            
              <!-- Variable bindings for this tree-->
  
  


  


<!-- Rendering of this tree -->
<div class='pl-2'>
  <!-- Node's rootLabel-->
  <div class='flex items-center my-2 space-x-2 justify-left'>
    
    
      <svg class='w-4 h-4 flex-shrink-0 inline' fill='none' stroke='currentColor' viewBox='0 0 24 24' xmlns='http://www.w3.org/2000/svg'>
        <path stroke-linecap='round' stroke-linejoin='round' stroke-width='2' d='M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z'>
        </path>
      </svg>
      
  
    <a class='font-bold text-blue-600 hover:underline truncate' title='Staying In Bounds' href='size-test'>
      Staying In Bounds
    </a>
    
      
  </div>

  <!-- Node's children forest, displayed only on active trees
    TODO: Use <details> to toggle visibility?
  -->
  
    
  
</div>
            
              <!-- Variable bindings for this tree-->
  
    
      
    
    



  


<!-- Rendering of this tree -->
<div class='pl-2'>
  <!-- Node's rootLabel-->
  <div class='flex items-center my-2 space-x-2 justify-left'>
    
    
      <svg class='w-4 h-4 flex-shrink-0 inline' fill='none' stroke='currentColor' viewBox='0 0 24 24' xmlns='http://www.w3.org/2000/svg'>
        <path stroke-linecap='round' stroke-linejoin='round' stroke-width='2' d='M7 21h10a2 2 0 002-2V9.414a1 1 0 00-.293-.707l-5.414-5.414A1 1 0 0012.586 3H7a2 2 0 00-2 2v14a2 2 0 002 2z'>
        </path>
      </svg>
    
  
    <a class='hover:underline truncate' title='Stick Breaking Set' href='stick-breaking-set'>
      Stick Breaking Set
    </a>
    
      
  </div>

  <!-- Node's children forest, displayed only on active trees
    TODO: Use <details> to toggle visibility?
  -->
  
    
  
</div>
            
              <!-- Variable bindings for this tree-->
  
    
      
    
    



  


<!-- Rendering of this tree -->
<div class='pl-2'>
  <!-- Node's rootLabel-->
  <div class='flex items-center my-2 space-x-2 justify-left'>
    
    
      <svg class='w-4 h-4 flex-shrink-0 inline' fill='none' stroke='currentColor' viewBox='0 0 24 24' xmlns='http://www.w3.org/2000/svg'>
        <path stroke-linecap='round' stroke-linejoin='round' stroke-width='2' d='M7 21h10a2 2 0 002-2V9.414a1 1 0 00-.293-.707l-5.414-5.414A1 1 0 0012.586 3H7a2 2 0 00-2 2v14a2 2 0 002 2z'>
        </path>
      </svg>
    
  
    <a class='hover:underline truncate' title='The MIT License (MIT)' href='LICENSE'>
      The MIT License (MIT)
    </a>
    
      
  </div>

  <!-- Node's children forest, displayed only on active trees
    TODO: Use <details> to toggle visibility?
  -->
  
    
  
</div>
            
              <!-- Variable bindings for this tree-->
  
    
      
    
    



  


<!-- Rendering of this tree -->
<div class='pl-2'>
  <!-- Node's rootLabel-->
  <div class='flex items-center my-2 space-x-2 justify-left'>
    
    
      <svg class='w-4 h-4 flex-shrink-0 inline' fill='none' stroke='currentColor' viewBox='0 0 24 24' xmlns='http://www.w3.org/2000/svg'>
        <path stroke-linecap='round' stroke-linejoin='round' stroke-width='2' d='M7 21h10a2 2 0 002-2V9.414a1 1 0 00-.293-.707l-5.414-5.414A1 1 0 0012.586 3H7a2 2 0 00-2 2v14a2 2 0 002 2z'>
        </path>
      </svg>
    
  
    <a class='hover:underline truncate' title='The TxTP Architecture' href='transaction-token-protocol'>
      The TxTP Architecture
    </a>
    
      
  </div>

  <!-- Node's children forest, displayed only on active trees
    TODO: Use <details> to toggle visibility?
  -->
  
    
  
</div>
            
              <!-- Variable bindings for this tree-->
  
    
      
    
    



  


<!-- Rendering of this tree -->
<div class='pl-2'>
  <!-- Node's rootLabel-->
  <div class='flex items-center my-2 space-x-2 justify-left'>
    
    
      <svg class='w-4 h-4 flex-shrink-0 inline' fill='none' stroke='currentColor' viewBox='0 0 24 24' xmlns='http://www.w3.org/2000/svg'>
        <path stroke-linecap='round' stroke-linejoin='round' stroke-width='2' d='M7 21h10a2 2 0 002-2V9.414a1 1 0 00-.293-.707l-5.414-5.414A1 1 0 0012.586 3H7a2 2 0 00-2 2v14a2 2 0 002 2z'>
        </path>
      </svg>
    
  
    <a class='hover:underline truncate' title='Untyped Plutus Core' href='uplc'>
      Untyped Plutus Core
    </a>
    
      
  </div>

  <!-- Node's children forest, displayed only on active trees
    TODO: Use <details> to toggle visibility?
  -->
  
    
  
</div>
            
              <!-- Variable bindings for this tree-->
  
    
      
    
    



  


<!-- Rendering of this tree -->
<div class='pl-2'>
  <!-- Node's rootLabel-->
  <div class='flex items-center my-2 space-x-2 justify-left'>
    
    
      <svg class='w-4 h-4 flex-shrink-0 inline' fill='none' stroke='currentColor' viewBox='0 0 24 24' xmlns='http://www.w3.org/2000/svg'>
        <path stroke-linecap='round' stroke-linejoin='round' stroke-width='2' d='M7 21h10a2 2 0 002-2V9.414a1 1 0 00-.293-.707l-5.414-5.414A1 1 0 0012.586 3H7a2 2 0 00-2 2v14a2 2 0 002 2z'>
        </path>
      </svg>
    
  
    <a class='hover:underline truncate' title='User guide for plutus-numeric' href='user-guide-numeric'>
      User guide for <code>plutus-numeric</code>
    </a>
    
      
  </div>

  <!-- Node's children forest, displayed only on active trees
    TODO: Use <details> to toggle visibility?
  -->
  
    
  
</div>
            
              <!-- Variable bindings for this tree-->
  
    
      
    
    



  


<!-- Rendering of this tree -->
<div class='pl-2'>
  <!-- Node's rootLabel-->
  <div class='flex items-center my-2 space-x-2 justify-left'>
    
    
      <svg class='w-4 h-4 flex-shrink-0 inline' fill='none' stroke='currentColor' viewBox='0 0 24 24' xmlns='http://www.w3.org/2000/svg'>
        <path stroke-linecap='round' stroke-linejoin='round' stroke-width='2' d='M7 21h10a2 2 0 002-2V9.414a1 1 0 00-.293-.707l-5.414-5.414A1 1 0 0012.586 3H7a2 2 0 00-2 2v14a2 2 0 002 2z'>
        </path>
      </svg>
    
  
    <a class='hover:underline truncate' title='What is Data/BuiltinData?' href='builtin-data'>
      What is Data/BuiltinData?
    </a>
    
      
  </div>

  <!-- Node's children forest, displayed only on active trees
    TODO: Use <details> to toggle visibility?
  -->
  
    
  
</div>
            
              <!-- Variable bindings for this tree-->
  
    
      
    
    



  


<!-- Rendering of this tree -->
<div class='pl-2'>
  <!-- Node's rootLabel-->
  <div class='flex items-center my-2 space-x-2 justify-left'>
    
    
      <svg class='w-4 h-4 flex-shrink-0 inline' fill='none' stroke='currentColor' viewBox='0 0 24 24' xmlns='http://www.w3.org/2000/svg'>
        <path stroke-linecap='round' stroke-linejoin='round' stroke-width='2' d='M7 21h10a2 2 0 002-2V9.414a1 1 0 00-.293-.707l-5.414-5.414A1 1 0 0012.586 3H7a2 2 0 00-2 2v14a2 2 0 002 2z'>
        </path>
      </svg>
    
  
    <a class='hover:underline truncate' title='Working with Builtin Lists' href='builtin-lists'>
      Working with Builtin Lists
    </a>
    
      
  </div>

  <!-- Node's children forest, displayed only on active trees
    TODO: Use <details> to toggle visibility?
  -->
  
    
  
</div>
            
              <!-- Variable bindings for this tree-->
  
    
      
    
    



  


<!-- Rendering of this tree -->
<div class='pl-2'>
  <!-- Node's rootLabel-->
  <div class='flex items-center my-2 space-x-2 justify-left'>
    
    
      <svg class='w-4 h-4 flex-shrink-0 inline' fill='none' stroke='currentColor' viewBox='0 0 24 24' xmlns='http://www.w3.org/2000/svg'>
        <path stroke-linecap='round' stroke-linejoin='round' stroke-width='2' d='M7 21h10a2 2 0 002-2V9.414a1 1 0 00-.293-.707l-5.414-5.414A1 1 0 0012.586 3H7a2 2 0 00-2 2v14a2 2 0 002 2z'>
        </path>
      </svg>
    
  
    <a class='hover:underline truncate' title='Working with Builtin Pairs' href='builtin-pairs'>
      Working with Builtin Pairs
    </a>
    
      
  </div>

  <!-- Node's children forest, displayed only on active trees
    TODO: Use <details> to toggle visibility?
  -->
  
    
  
</div>
            
              <!-- Variable bindings for this tree-->
  
    
      
    
    



  


<!-- Rendering of this tree -->
<div class='pl-2'>
  <!-- Node's rootLabel-->
  <div class='flex items-center my-2 space-x-2 justify-left'>
    
    
      <svg class='w-4 h-4 flex-shrink-0 inline' fill='none' stroke='currentColor' viewBox='0 0 24 24' xmlns='http://www.w3.org/2000/svg'>
        <path stroke-linecap='round' stroke-linejoin='round' stroke-width='2' d='M7 21h10a2 2 0 002-2V9.414a1 1 0 00-.293-.707l-5.414-5.414A1 1 0 0012.586 3H7a2 2 0 00-2 2v14a2 2 0 002 2z'>
        </path>
      </svg>
    
  
    <a class='hover:underline truncate' title='transaction-perspective' href='transaction-perspective'>
      transaction-perspective
    </a>
    
      
  </div>

  <!-- Node's children forest, displayed only on active trees
    TODO: Use <details> to toggle visibility?
  -->
  
    
  
</div>
            
              <!-- Variable bindings for this tree-->
  
    
      
    
    



  


<!-- Rendering of this tree -->
<div class='pl-2'>
  <!-- Node's rootLabel-->
  <div class='flex items-center my-2 space-x-2 justify-left'>
    
    
      <svg class='w-4 h-4 flex-shrink-0 inline' fill='none' stroke='currentColor' viewBox='0 0 24 24' xmlns='http://www.w3.org/2000/svg'>
        <path stroke-linecap='round' stroke-linejoin='round' stroke-width='2' d='M7 21h10a2 2 0 002-2V9.414a1 1 0 00-.293-.707l-5.414-5.414A1 1 0 0012.586 3H7a2 2 0 00-2 2v14a2 2 0 002 2z'>
        </path>
      </svg>
    
  
    <a class='hover:underline truncate' title='transaction-token-pattern' href='transaction-token-pattern'>
      transaction-token-pattern
    </a>
    
      
  </div>

  <!-- Node's children forest, displayed only on active trees
    TODO: Use <details> to toggle visibility?
  -->
  
    
  
</div>
            

          </div>
        </nav>

        <!-- Main body column -->
        <div class='flex-1 w-full overflow-x-auto bg-white'>
          <main class='px-4 py-4'>
            <h1 class='flex items-end justify-center mb-4 p-3 bg-blue-100 text-5xl font-extrabold text-black rounded'>
  <a class='z-40 tracking-tighter '>
    Staying In Bounds
  </a>
</h1>
            <article class='overflow-auto'>
  <!-- What goes in this file will appear on top of note body-->
  <h2 id='introduction' class='inline-block mt-6 mb-4 text-4xl font-bold text-gray-700 border-b-2'>Introduction</h2>
    <p class='mb-3'>
      Plutus imposes <a href='fundamentals#Script-sizes' class='text-blue-600 mavenLinkBold hover:underline'>severe size limits</a> on objects that exist on-chain, whether these are functions, values, or combinations of the two. Additionally, due to the way the Plutus compiler works, <em>everything</em> ends up being inlined, further increasing the potential sizes of everything. Therefore, it is important to be aware of how large your on-chain entities are, and ensure that they don’t grow too large; this is <em>especially</em> true for library functions, or any functionality that will be used in many places.
    </p>
  
    <p class='mb-3'>
      Finding out the exact on-chain size of any given thing is doable, but a bit awkward. To make this easier, we have <a href='https://github.com/Liqwid-Labs/plutus-extra/tree/master/plutus-size-check' class='text-blue-600 hover:underline' target='_blank' rel='noopener'><code class='py-0.5 px-1 rounded bg-gray-700 text-sm text-white'>plutus-size-check</code></a>, which is a <a href='https://hackage.haskell.org/package/tasty' class='text-blue-600 hover:underline' target='_blank' rel='noopener'><code class='py-0.5 px-1 rounded bg-gray-700 text-sm text-white'>tasty</code></a>-based support library for testing on-chain entities for their size. It provides the ability to test whether an entity would fit on-chain at all, or within a user-provided size; together with <a href='https://hackage.haskell.org/package/tasty-expected-failure' class='text-blue-600 hover:underline' target='_blank' rel='noopener'><code class='py-0.5 px-1 rounded bg-gray-700 text-sm text-white'>tasty-expected-failure</code></a>, it can be used to discover and document sizes without requiring them to fit.
    </p>
  
    <p class='mb-3'>
      This tutorial describes how to use <code class='py-0.5 px-1 rounded bg-gray-700 text-sm text-white'>plutus-size-check</code>, using a running example. We also talk about several caveats of its use, allowing you to avoid common issues that would be hard to diagnose otherwise.
    </p>
  <h2 id='worked-example' class='inline-block mt-6 mb-4 text-4xl font-bold text-gray-700 border-b-2'>Worked example</h2>
    <p class='mb-3'>
      Suppose we have the following module, defining a useful function to compute the sum of squares:
    </p>
  <div class='py-0.5 mb-3 text-sm'><pre><code class='haskell language-haskell'>{-# OPTIONS_GHC -fno-specialize #-}
{-# LANGUAGE KindSignatures #-}
{-# LANGUAGE NoImplicitPrelude #-}
{-# LANGUAGE ScopedTypeVariables #-}

module Foo (sumOfSquares) where

import Data.Kind (Type)
import PlutusTx.Prelude

{-# INLINEABLE sumOfSquares #-}
sumOfSquares :: forall (a :: Type) . 
  (MultiplicativeSemigroup a, AdditiveSemigroup a) =&gt;
  a -&gt; a -&gt; a
sumOfSquares = ... -- super secret implementation</code></pre></div>
    <p class='mb-3'>
      Since we expect this function to be used frequently, we want to know the size of its on-chain representation. We will use <code class='py-0.5 px-1 rounded bg-gray-700 text-sm text-white'>plutus-size-check</code> to do this.
    </p>
  
    <p class='mb-3'>
      To use <code class='py-0.5 px-1 rounded bg-gray-700 text-sm text-white'>plutus-size-check</code> for this purpose, we need to do the following steps:
    </p>
  
    <ul class='my-3 ml-6 space-y-1 list-decimal list-inside'>
      
        <li>
          Compile <code class='py-0.5 px-1 rounded bg-gray-700 text-sm text-white'>sumOfSquares</code> using the Plutus compiler to produce a <code class='py-0.5 px-1 rounded bg-gray-700 text-sm text-white'>CompiledCode</code>.
        </li>
      
        <li>
          Wrap the resulting <code class='py-0.5 px-1 rounded bg-gray-700 text-sm text-white'>CompiledCode</code> into a <code class='py-0.5 px-1 rounded bg-gray-700 text-sm text-white'>Script</code>.
        </li>
      
        <li>
          Pass it to <a href='https://github.com/Liqwid-Labs/plutus-extra/blob/master/plutus-size-check/src/Test/Tasty/Plutus/Size.hs#L157' class='text-blue-600 hover:underline' target='_blank' rel='noopener'><code class='py-0.5 px-1 rounded bg-gray-700 text-sm text-white'>fitsOnChain</code></a> or <a href='https://github.com/Liqwid-Labs/plutus-extra/blob/master/plutus-size-check/src/Test/Tasty/Plutus/Size.hs#L177' class='text-blue-600 hover:underline' target='_blank' rel='noopener'><code class='py-0.5 px-1 rounded bg-gray-700 text-sm text-white'>fitsInto</code></a> to make a <code class='py-0.5 px-1 rounded bg-gray-700 text-sm text-white'>TestTree</code>.
        </li>
      
        <li>
          Put the resulting <code class='py-0.5 px-1 rounded bg-gray-700 text-sm text-white'>TestTree</code> into a <code class='py-0.5 px-1 rounded bg-gray-700 text-sm text-white'>tasty</code> runner.
        </li>
      
    </ul>
  
    <p class='mb-3'>
      To do this, you will need to create a test suite which includes the following dependencies:
    </p>
  
    <ul class='my-3 ml-6 space-y-1 list-disc'>
      
        <li>
          <code class='py-0.5 px-1 rounded bg-gray-700 text-sm text-white'>plutus-size-check</code>
        </li>
      
        <li>
          <code class='py-0.5 px-1 rounded bg-gray-700 text-sm text-white'>tasty</code>
        </li>
      
        <li>
          <code class='py-0.5 px-1 rounded bg-gray-700 text-sm text-white'>plutus-ledger-api</code>
        </li>
      
        <li>
          <code class='py-0.5 px-1 rounded bg-gray-700 text-sm text-white'>plutus-tx</code>
        </li>
      
        <li>
          <code class='py-0.5 px-1 rounded bg-gray-700 text-sm text-white'>plutus-tx-plugin</code>
        </li>
      
    </ul>
  
    <p class='mb-3'>
      You may need other Plutus libraries as well, depending on what you’re testing, but the list above is the minimum necessary. Throughout, we’ll be working in a test module, which initially starts off like so:
    </p>
  <div class='py-0.5 mb-3 text-sm'><pre><code class='haskell language-haskell'>module Main (main) where

main :: IO ()
main = _</code></pre></div><h3 id='compiling-sumofsquares' class='mt-6 mb-2 text-3xl font-bold text-gray-700'>Compiling <code class='py-0.5 px-1 rounded bg-gray-700 text-sm text-white'>sumOfSquares</code></h3>
    <p class='mb-3'>
      We use the <code class='py-0.5 px-1 rounded bg-gray-700 text-sm text-white'>compile</code> quasi-quoter from <code class='py-0.5 px-1 rounded bg-gray-700 text-sm text-white'>PlutusTx.TH</code> for this purpose. As this produces a <a href='https://markkarpov.com/tutorial/th.html#typed-expressions' class='text-blue-600 hover:underline' target='_blank' rel='noopener'>typed splice</a>, we need to enable several extensions. Here is our first attempt:
    </p>
  <div class='py-0.5 mb-3 text-sm'><pre><code class='haskell language-haskell'>{-# LANGUAGE KindSignatures #-}
{-# LANGUAGE ScopedTypeVariables #-}
{-# LANGUAGE TemplateHaskell #-}

module Main (main) where

import Data.Kind (Type)
import Foo (sumOfSquares)
import PlutusTx.Code (CompiledCode)
import PlutusTx.TH (compile)

main :: IO ()
main = _

-- Helpers

compiledSumOfSquares :: forall (a :: Type) . CompiledCode (a -&gt; a -&gt; a)
compiledSumOfSquares = $$(compile [|| sumOfSquares ||])</code></pre></div>
    <p class='mb-3'>
      This already raises two caveats to be careful of. Firstly, the <a href='https://markkarpov.com/tutorial/th.html#limitations-of-th' class='text-blue-600 hover:underline' target='_blank' rel='noopener'>TH staging restriction</a> means that we cannot use <code class='py-0.5 px-1 rounded bg-gray-700 text-sm text-white'>compile</code> on a definition in the same module. This doesn’t trip us up here, but anything you want to <code class='py-0.5 px-1 rounded bg-gray-700 text-sm text-white'>compile</code> <em>must</em> be defined in a different module to the one you use <code class='py-0.5 px-1 rounded bg-gray-700 text-sm text-white'>compile</code> in. The second is more subtle: we cannot compile the definition as-is, as it relies on a polymorphic type variable, which will produce an error about <code class='py-0.5 px-1 rounded bg-gray-700 text-sm text-white'>a</code> not being inlined. To avoid this, we need to instantiate <code class='py-0.5 px-1 rounded bg-gray-700 text-sm text-white'>a</code> to a concrete type: in our case, <code class='py-0.5 px-1 rounded bg-gray-700 text-sm text-white'>Integer</code> will do fine. This gives us the following revised definition:
    </p>
  <div class='py-0.5 mb-3 text-sm'><pre><code class='haskell language-haskell'>{-# LANGUAGE TemplateHaskell #-}

module Main (main) where

import Foo (sumOfSquares)
import PlutusTx.Code (CompiledCode)
import PlutusTx.TH (compile)

main :: IO ()
main = _

-- Helpers

compiledSumOfSquares :: CompiledCode (Integer -&gt; Integer -&gt; Integer)
compiledSumOfSquares = $$(compile [|| sumOfSquares ||])</code></pre></div>
    <p class='mb-3'>
      For reasons of consistency, we should choose these ‘concretifications’ carefully: picking them without some kind of system in place will definitely create problems when comparing sizes of functions. We recommend using <code class='py-0.5 px-1 rounded bg-gray-700 text-sm text-white'>Integer</code> for ‘concretifying’ type variables where necessary.
    </p>
  <h3 id='wrapping-into-a-script' class='mt-6 mb-2 text-3xl font-bold text-gray-700'>Wrapping into a <code class='py-0.5 px-1 rounded bg-gray-700 text-sm text-white'>Script</code></h3>
    <p class='mb-3'>
      The next step is to produce a <code class='py-0.5 px-1 rounded bg-gray-700 text-sm text-white'>Script</code>, which can be used by <code class='py-0.5 px-1 rounded bg-gray-700 text-sm text-white'>plutus-size-check</code>. For this, we use <code class='py-0.5 px-1 rounded bg-gray-700 text-sm text-white'>fromCompiledCode</code>, which is in <code class='py-0.5 px-1 rounded bg-gray-700 text-sm text-white'>Plutus.V1.Ledger.Scripts</code>:
    </p>
  <div class='py-0.5 mb-3 text-sm'><pre><code class='haskell language-haskell'>{-# LANGUAGE TemplateHaskell #-}

module Main (main) where

import Foo (sumOfSquares)
import Plutus.V1.Ledger.Scripts (fromCompiledCode)
import PlutusTx.Code (CompiledCode)
import PlutusTx.TH (compile)

main :: IO ()
main = _

-- Helpers

compiledSumOfSquares :: CompiledCode (Integer -&gt; Integer -&gt; Integer)
compiledSumOfSquares = $$(compile [|| sumOfSquares ||])

testingScript :: Script
testingScript = fromCompiledCode compiledSumOfSquares</code></pre></div>
    <p class='mb-3'>
      The term <code class='py-0.5 px-1 rounded bg-gray-700 text-sm text-white'>Script</code> is slightly misleading in this case, as it can wrap <em>any</em> <code class='py-0.5 px-1 rounded bg-gray-700 text-sm text-white'>CompiledCode</code>, which doesn’t necessarily have to be a ‘script’ in the Plutus sense of the term.
    </p>
  <h3 id='making-a-testtree-and-running' class='mt-6 mb-2 text-3xl font-bold text-gray-700'>Making a <code class='py-0.5 px-1 rounded bg-gray-700 text-sm text-white'>TestTree</code> and running</h3>
    <p class='mb-3'>
      We can now finish the module and produce something runnable. As we don’t (currently) have any knowledge of how large <code class='py-0.5 px-1 rounded bg-gray-700 text-sm text-white'>sumOfSquares</code> is on-chain, we’ll use <code class='py-0.5 px-1 rounded bg-gray-700 text-sm text-white'>fitsOnChain</code> from <code class='py-0.5 px-1 rounded bg-gray-700 text-sm text-white'>Test.Tasty.Plutus.Size</code>, which will check if it will fit into the 16KiB limit as such.
    </p>
  <div class='py-0.5 mb-3 text-sm'><pre><code class='haskell language-haskell'>{-# LANGUAGE TemplateHaskell #-}

module Main (main) where

import Foo (sumOfSquares)
import Plutus.V1.Ledger.Scripts (fromCompiledCode)
import PlutusTx.Code (CompiledCode)
import PlutusTx.TH (compile)
import Test.Tasty (defaultMain, testGroup)
import Test.Tasty.Plutus.Size (fitsOnChain)

main :: IO ()
main = defaultMain . testGroup "On-chain size" $ [
  fitsOnChain "sumOfSquares" testingScript
  ]

-- Helpers

compiledSumOfSquares :: CompiledCode (Integer -&gt; Integer -&gt; Integer)
compiledSumOfSquares = $$(compile [|| sumOfSquares ||])

testingScript :: Script
testingScript = fromCompiledCode compiledSumOfSquares</code></pre></div>
    <p class='mb-3'>
      To save some space, we can inline <code class='py-0.5 px-1 rounded bg-gray-700 text-sm text-white'>testingScript</code> as well:
    </p>
  <div class='py-0.5 mb-3 text-sm'><pre><code class='haskell language-haskell'>{-# LANGUAGE TemplateHaskell #-}

module Main (main) where

import Foo (sumOfSquares)
import Plutus.V1.Ledger.Scripts (fromCompiledCode)
import PlutusTx.Code (CompiledCode)
import PlutusTx.TH (compile)
import Test.Tasty (defaultMain, testGroup)
import Test.Tasty.Plutus.Size (fitsOnChain)

main :: IO ()
main = defaultMain . testGroup "On-chain size" $ [
  fitsOnChain "sumOfSquares" . fromCompiledCode $ compiledSumOfSquares
  ]

-- Helpers

compiledSumOfSquares :: CompiledCode (Integer -&gt; Integer -&gt; Integer)
compiledSumOfSquares = $$(compile [|| sumOfSquares ||])</code></pre></div>
    <p class='mb-3'>
      We now have a runnable test suite. This will produce output similar to what’s below, except for the size (which is fictionalized):
    </p>
  <div class='py-0.5 mb-3 text-sm'><pre><code class='language-none'>On-chain size
  sumOfSquares fits on-chain:                     OK
    Size: 1001B (~1KiB)</code></pre></div>
    <p class='mb-3'>
      Now that we have a measurement, we can ‘pin it in place’ to avoid size regressions, using <code class='py-0.5 px-1 rounded bg-gray-700 text-sm text-white'>fitsInto</code>:
    </p>
  <div class='py-0.5 mb-3 text-sm'><pre><code class='haskell language-haskell'>{-# LANGUAGE QuasiQuotes #-}
{-# LANGUAGE TemplateHaskell #-}

module Main (main) where

import Foo (sumOfSquares)
import Plutus.V1.Ledger.Scripts (fromCompiledCode)
import PlutusTx.Code (CompiledCode)
import PlutusTx.TH (compile)
import Test.Tasty (defaultMain, testGroup)
import Test.Tasty.Plutus.Size (fitsInto, bytes)

main :: IO ()
main = defaultMain . testGroup "On-chain size" $ [
  fitsInto "sumOfSquares" [bytes| 1001 |] . fromCompiledCode $ compiledSumOfSquares
  ]

-- Helpers

compiledSumOfSquares :: CompiledCode (Integer -&gt; Integer -&gt; Integer)
compiledSumOfSquares = $$(compile [|| sumOfSquares ||])</code></pre></div>
    <p class='mb-3'>
      Now, if we refactor or modify <code class='py-0.5 px-1 rounded bg-gray-700 text-sm text-white'>sumOfSquares</code> in a way that exceeds this size, our tests will fail, indicating the current size in the process.
    </p>
  <h2 id='common-caveats-issues-and-solutions' class='inline-block mt-6 mb-4 text-4xl font-bold text-gray-700 border-b-2'>Common caveats, issues and solutions</h2><h3 id='th-staging-restriction' class='mt-6 mb-2 text-3xl font-bold text-gray-700'>TH staging restriction</h3>
    <p class='mb-3'>
      This is a limitation of the Plutus compiler and GHC both; the former relies on <a href='https://markkarpov.com/tutorial/th.html#typed-expressions' class='text-blue-600 hover:underline' target='_blank' rel='noopener'>typed splices</a>, and the latter has the <a href='https://markkarpov.com/tutorial/th.html#limitations-of-th' class='text-blue-600 hover:underline' target='_blank' rel='noopener'>staging restriction</a>. What this means in practice is that code such as the following will <em>not</em> compile:
    </p>
  <div class='py-0.5 mb-3 text-sm'><pre><code class='haskell language-haskell'>foo :: Integer -&gt; Integer
foo = ... -- some definition

compiledFoo :: CompiledCode (Integer -&gt; Integer)
compiledFoo = $$(compile [|| foo ||])</code></pre></div>
    <p class='mb-3'>
      To solve this, place <code class='py-0.5 px-1 rounded bg-gray-700 text-sm text-white'>foo</code> in a separate module to <code class='py-0.5 px-1 rounded bg-gray-700 text-sm text-white'>compiledFoo</code>.
    </p>
  <h3 id='polymorphic-compiles' class='mt-6 mb-2 text-3xl font-bold text-gray-700'>Polymorphic compiles</h3>
    <p class='mb-3'>
      This is also a limitation of the Plutus compiler. Consider the code below:
    </p>
  <div class='py-0.5 mb-3 text-sm'><pre><code class='haskell language-haskell'>-- This won't work
compiledBar :: CompiledCode (a -&gt; a -&gt; a)
compiledBar = $$(compile [|| someThing ||])</code></pre></div>
    <p class='mb-3'>
      This code will fail to get through the Plutus compiler, complaining about <code class='py-0.5 px-1 rounded bg-gray-700 text-sm text-white'>a</code> not being inlined. To avoid this problem, ensure that you ‘concretify’ your type variables like so:
    </p>
  <div class='py-0.5 mb-3 text-sm'><pre><code class='haskell language-haskell'>-- Fixed
compiledBar :: CompiledCode (Integer -&gt; Integer -&gt; Integer)
compiledBar = $$(compile [|| someThing ||])</code></pre></div>
    <p class='mb-3'>
      If you plan to compare function sizes amongst each other, be consistent with your choice of ‘concretification’ type. We recommend using <code class='py-0.5 px-1 rounded bg-gray-700 text-sm text-white'>Integer</code> if you have no better choice available.
    </p>
  <h3 id='applying-arguments-to-compiled-functions' class='mt-6 mb-2 text-3xl font-bold text-gray-700'>Applying arguments to compiled functions</h3>
    <p class='mb-3'>
      Some tests require ‘compositional’ data, where functions need to have ‘baked in’ arguments provided by non-constants. This is common when testing validators or minting policies that take arguments beyond their datum and/or redeemer. The ‘obvious’ way of doing this can yield compilation problems:
    </p>
  <div class='py-0.5 mb-3 text-sm'><pre><code class='haskell language-haskell'>-- Assume bar :: Integer -&gt; Integer -&gt; Integer and baz :: Integer
-- Both of these are defined out-of-module
compiledFoo :: CompiledCode (Integer -&gt; Integer)
compiledFoo = $$(compile [|| bar baz ||]) -- This will likely not compile</code></pre></div>
    <p class='mb-3'>
      If this is the case, you need to use <code class='py-0.5 px-1 rounded bg-gray-700 text-sm text-white'>applyCode</code> from <code class='py-0.5 px-1 rounded bg-gray-700 text-sm text-white'>PlutusTx.Code</code>:
    </p>
  <div class='py-0.5 mb-3 text-sm'><pre><code class='haskell language-haskell'>compiledBaz :: CompiledCode Integer
compiledBaz = $$(compile [|| baz ||])

compiledBar :: CompiledCode (Integer -&gt; Integer -&gt; Integer)
compiledBar = $$(compile [|| bar ||])

compiledFoo :: CompiledCode (Integer -&gt; Integer)
compiledFoo = compiledBar `applyCode` compiledBaz</code></pre></div>
    <p class='mb-3'>
      This is a limitation of the Plutus compiler, as well as a requirement of the size-measuring interface provided by Plutus (which must be given <code class='py-0.5 px-1 rounded bg-gray-700 text-sm text-white'>CompiledCode</code>).
    </p>
  <h3 id='expected-failures' class='mt-6 mb-2 text-3xl font-bold text-gray-700'>Expected failures</h3>
    <p class='mb-3'>
      Sometimes, you may have on-chain entities whose sizes are too large to fit on-chain, or into a specific limit, but you want to track their sizes in a testable way. Usually, this is needed for future-proofing or simply to find out what the size actually is at the moment. The easiest way to do this is to use <code class='py-0.5 px-1 rounded bg-gray-700 text-sm text-white'>tasty-expected-failure</code>:
    </p>
  <div class='py-0.5 mb-3 text-sm'><pre><code class='haskell language-haskell'>import Test.Tasty.ExpectedFailure (expectFail)

myBrokenSizeTests :: TestTree
myBrokenSizeTests = testGroup "Some of these break" [
  expectFail . fitsOnChain "Too big" . fromCompiledCode $ something,
  fitsOnChain "But this is OK" . fromCompiledCode $ somethingElse,
  ...</code></pre></div><h2 id='conclusion' class='inline-block mt-6 mb-4 text-4xl font-bold text-gray-700 border-b-2'>Conclusion</h2>
    <p class='mb-3'>
      Using <code class='py-0.5 px-1 rounded bg-gray-700 text-sm text-white'>plutus-size-check</code>, we can ensure that our on-chain entities will fit into the limits imposed by Plutus, and protect against regressions in the size of functionality. This is particularly critical when defining functionality that will be used in many places, due to Plutus’ prolific inlining requirements. While this is not without its limitations, this guide specifies how to avoid them, while still getting the ability to test script size with confidence.
    </p>
  <h2 id='further-reading' class='inline-block mt-6 mb-4 text-4xl font-bold text-gray-700 border-b-2'>Further reading</h2>
    <ul class='my-3 ml-6 space-y-1 list-disc'>
      
        <li>
          Mark Karpov’s <a href='https://markkarpov.com/tutorial/th.htm' class='text-blue-600 hover:underline' target='_blank' rel='noopener'>Template Haskell tutorial</a>
        </li>
      
        <li>
          <a href='fundamentals' class='text-blue-600 mavenLinkBold hover:underline'>Fundamentals of Plutus</a>
        </li>
      
        <li>
          <a href='optimisations' class='text-blue-600 mavenLinkBold hover:underline'>Techniques</a> for script size reduction
        </li>
      
    </ul>
  
  <!-- What goes in this file will appear below the note body-->
</article>
            <div class='flex flex-col lg:flex-row lg:space-x-2'>
              
              
  <div class='flex-1 p-4 mt-8 bg-gray-100 rounded'>
    <header class='mb-2 text-xl font-semibold text-gray-500'>Links to this page</header>
    <ul class='space-y-1'>
      
        <li>
          <a class='text-blue-600 mavenLinkBold hover:bg-blue-50' href='README'>
            README
          </a>
          
            <div class='mb-4 overflow-auto text-sm text-gray-500'>
  
    <div class='pl-2 mt-2 border-l-2 border-blue-200 hover:border-blue-500'>
      <div><a href='size-test' class='text-gray-600 font-bold hover:bg-gray-50'>Staying In Bounds</a>, which describes the testing interface for Plutus on-chain size provided by <a href='https://github.com/Liqwid-Labs/plutus-extra/tree/master/plutus-size-check' class='text-gray-600 hover:underline' target='_blank' rel='noopener'><code>plutus-size-check</code></a>.</div>
    </div>
  
</div>
          
        </li>
      
    </ul>
  </div>

            </div>
            
  <section class='flex flex-wrap items-end justify-center my-4 space-x-2 space-y-2 font-mono text-sm'>
    
  </section>

            <!-- What goes in this file will at the very end of the main div -->
          </main>
        </div>
      </div>
      <footer class='flex items-center justify-center mt-2 mb-8 space-x-4 text-center text-gray-800'>
  
  <div>
    <a href='' title='Go to Home page'>
      <svg xmlns='http://www.w3.org/2000/svg' class='w-6 h-6 hover:text-blue-700' fill='none' viewBox='0 0 24 24' stroke='currentColor'>
        <path stroke-linecap='round' stroke-linejoin='round' stroke-width='2' d='M3 12l2-2m0 0l7-7 7 7M5 10v10a1 1 0 001 1h3m10-11l2 2m-2-2v10a1 1 0 01-1 1h-3m-6 0a1 1 0 001-1v-4a1 1 0 011-1h2a1 1 0 011 1v4a1 1 0 001 1m-6 0h6'></path>
      </svg>
    </a>
  </div>
  <div>
    <a href='-/all' title='View Index'>
      <svg class='w-6 h-6 hover:text-blue-700' fill='none' stroke='currentColor' viewBox='0 0 24 24' xmlns='http://www.w3.org/2000/svg'>
        <path stroke-linecap='round' stroke-linejoin='round' stroke-width='2' d='M4 8V4m0 0h4M4 4l5 5m11-1V4m0 0h-4m4 0l-5 5M4 16v4m0 0h4m-4 0l5-5m11 5l-5-5m5 5v-4m0 4h-4'>
        </path>
      </svg>
    </a>
  </div>
  <div>
    <a href='https://emanote.srid.ca' target='_blank' title='Generated by Emanote 0.5.3.0'>
      <img class='w-6 h-6 hover:text-blue-700' src='_emanote-static/emanote-logo.svg' />
    </a>
  </div>
  <div>
    <a href='-/tags' title='View tags'>
      <svg class='w-6 h-6 hover:text-blue-700' fill='none' stroke='currentColor' viewBox='0 0 24 24' xmlns='http://www.w3.org/2000/svg'>
        <path stroke-linecap='round' stroke-linejoin='round' stroke-width='2' d='M7 7h.01M7 3h5c.512 0 1.024.195 1.414.586l7 7a2 2 0 010 2.828l-7 7a2 2 0 01-2.828 0l-7-7A1.994 1.994 0 013 12V7a4 4 0 014-4z'>
        </path>
      </svg>
    </a>
  </div>
  <div>
    <a href='-/tasks' title='View tasks'>
      <svg xmlns='http://www.w3.org/2000/svg' class='w-6 h-6 hover:text-blue-700' fill='none' viewBox='0 0 24 24' stroke='currentColor'>
        <path stroke-linecap='round' stroke-linejoin='round' stroke-width='2' d='M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z'></path>
      </svg>
    </a>
  </div>
</footer>
    </div>
  
</body>

</html>